<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders | Vastramaya</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --brand-primary: #8b2635;
            --brand-secondary: #d33d49;
            --page-bg: #fefcf3;
            --text-main: #3f0b17;
            --text-light: #a3715f;
            --white: #ffffff;
            --border: #e8d5c4;
            
            /* Status Colors */
            --status-ordered: #f39c12;
            --status-shipped: #3498db;
            --status-delivered: #27ae60;
            --status-cancelled: #e74c3c;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background-color: var(--page-bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
        }

        .header {
            background: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .back-btn {
            text-decoration: none;
            color: var(--text-main);
            font-size: 20px;
            margin-right: 20px;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
        }

        h1 { font-size: 24px; margin-bottom: 20px; }

        /* Order Card */
        .order-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(59, 11, 23, 0.05);
        }

        .order-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fffcf9;
        }

        .order-id { font-weight: 700; font-size: 14px; color: var(--text-light); }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-ordered { background: #fff4e5; color: var(--status-ordered); }
        .status-shipped { background: #eaf4fb; color: var(--status-shipped); }
        .status-delivered { background: #eafaf1; color: var(--status-delivered); }
        .status-cancelled { background: #fdeaea; color: var(--status-cancelled); }

        .order-body { padding: 15px; }

        .item-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .item-img {
            width: 70px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .item-details { flex: 1; }
        .item-name { font-weight: 600; font-size: 15px; margin-bottom: 4px; }
        .item-meta { font-size: 13px; color: var(--text-light); }

        .order-footer {
            padding: 15px;
            background: #fdfaf7;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-total { font-weight: 700; font-size: 18px; color: var(--brand-primary); }
        .order-date { font-size: 13px; color: var(--text-light); }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-state i { font-size: 50px; color: var(--border); margin-bottom: 20px; }
        
        .btn-shop {
            display: inline-block;
            background: var(--brand-primary);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            margin-top: 20px;
            font-weight: 600;
        }

        /* Loading Spinner */
        #loader { text-align: center; padding: 40px; }
    </style>
</head>
<body>

    <div class="header">
        <a href="shop.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
        <h2 style="margin:0; font-size: 18px;">My Orders</h2>
    </div>

    <div class="container">
        <div id="loader"><i class="fas fa-spinner fa-spin"></i> Loading your orders...</div>
        <div id="orders-container"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCdeonH3VytC21F3X6x0rCVCn2xXrGPoug",
            authDomain: "vastramaya---magic.firebaseapp.com",
            projectId: "vastramaya---magic",
            storageBucket: "vastramaya---magic.firebasestorage.app",
            messagingSenderId: "543460072082",
            appId: "1:543460072082:web:f3d1140e8f81ad338ae44b"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(user => {
            if (user) {
                fetchOrders(user.uid);
            } else {
                window.location.href = "login.html"; // Redirect if not logged in
            }
        });

        function fetchOrders(uid) {
            db.collection('users').doc(uid).collection('orders')
              .orderBy('createdAt', 'desc')
              .onSnapshot(snapshot => {
                  document.getElementById('loader').style.display = 'none';
                  const container = document.getElementById('orders-container');
                  
                  if (snapshot.empty) {
                      container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-shopping-bag"></i>
                            <h3>No Orders Yet</h3>
                            <p>You haven't placed any orders with us yet.</p>
                            <a href="shop.html" class="btn-shop">Start Shopping</a>
                        </div>`;
                      return;
                  }

                  let html = '';
                  snapshot.forEach(doc => {
                      const order = doc.data();
                      const date = order.createdAt ? new Date(order.createdAt.seconds * 1000).toLocaleDateString('en-IN', {
                          day: 'numeric', month: 'short', year: 'numeric'
                      }) : 'Pending';

                      html += `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="order-id">ID: #${order.orderId}</span>
                                <span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span>
                            </div>
                            <div class="order-body">
                                ${order.items.map(item => `
                                    <div class="item-row">
                                        <img src="${item.image}" class="item-img">
                                        <div class="item-details">
                                            <div class="item-name">${item.name}</div>
                                            <div class="item-meta">Size: ${item.size || 'N/A'} | Qty: ${item.quantity}</div>
                                            <div style="font-weight:700; margin-top:5px;">₹${item.price.toLocaleString()}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="order-footer">
                                <div class="order-date">Placed on ${date}</div>
                                <div class="order-total">₹${order.amount.toLocaleString()}</div>
                            </div>
                        </div>
                      `;
                  });
                  container.innerHTML = html;
              });
        }
    </script>
</body>
</html>
